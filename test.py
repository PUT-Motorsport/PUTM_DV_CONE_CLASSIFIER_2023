import os
import sys
import pandas as pd
import numpy as np
from descartes import PolygonPatch
import matplotlib.pyplot as plt
sys.path.insert(0, os.path.dirname(os.getcwd()))
import alphashape
import shapely
import time

points_2d = np.array([[ 31.,    5. ],
 [ 22.3,  17. ],
 [ 14.7,   3. ],
 [-15. ,  -3. ],
 [-15. ,   8. ],
 [-13. ,  19. ],
 [ -8. ,  28. ],
 [ -0. ,  37. ],
 [  9. ,  43. ],
 [ 19. ,  47. ],
 [ 30. ,  47. ],
 [ 40. ,  42. ],
 [ 48. ,  35. ],
 [ 54. ,  26. ],
 [ 59. ,  16. ]])

points_2d = np.array([[192.7, 139. ],
 [183.1 ,144. ],
 [173.  ,146. ],
 [162.5 ,147. ],
 [152.1 ,146. ],
 [141.8 ,144. ],
 [131.6 ,141. ],
 [121.7 ,138. ],
 [112.2 ,134. ],
 [102.8 ,129. ],
 [ 92.9 ,125. ],
 [ 82.7 ,123. ],
 [ 72.2 ,123. ],
 [ 61.7 ,123. ],
 [ 51.3 ,122. ],
 [ 42.1 ,118. ],
 [ 34.8 ,110. ],
 [ 28.7 ,102. ],
 [ 23.7 , 92. ],
 [ 19.9 , 83. ],
 [ 17.  , 72. ],
 [ 14.4 , 62. ],
 [ 12.2 , 52. ],
 [ 10.8 , 42. ],
 [ 11.1 , 31. ],
 [ 13.1 , 21. ],
 [ 14.6 , 10. ],
 [ 15.  ,  0. ],
 [-15.  , -0. ],
 [-16.  , 10. ],
 [-18.  , 21. ],
 [-19.  , 31. ],
 [-19.  , 41. ],
 [-18.  , 52. ],
 [-16.  , 62. ],
 [-14.  , 72. ],
 [-11.  , 82. ],
 [ -8.  , 92. ],
 [ -5.  ,102. ],
 [ -0.  ,112. ],
 [  5.  ,121. ],
 [ 12.  ,129. ],
 [ 18.  ,137. ],
 [ 27.  ,143. ],
 [ 36.  ,149. ],
 [ 45.  ,152. ],
 [ 56.  ,153. ],
 [ 66.  ,153. ],
 [ 77.  ,153. ],
 [ 87.  ,155. ],
 [ 96.  ,159. ],
 [106.  ,164. ],
 [116.  ,168. ],
 [125.  ,171. ],
 [136.  ,173. ],
 [146.  ,175. ],
 [156.  ,177. ],
 [167.  ,177. ],
 [177.  ,176. ],
 [187.  ,174. ],
 [197.  ,170. ],
 [207.  ,166. ]])

points_2d = np.array([[-136.3,  256. ],
 [-125.8,  255. ],
 [-115.5,  253. ],
 [-105.6,  249. ],
 [ -96.2,  245. ],
 [ -87.4,  239. ],
 [ -79.5,  232. ],
 [ -72.5,  224. ],
 [ -65.2,  217. ],
 [ -57.3,  210. ],
 [ -48.7,  204. ],
 [ -39.6,  198. ],
 [ -30.8,  193. ],
 [ -22.3,  187. ],
 [ -14.1,  180. ],
 [  -6.4,  173. ],
 [  -0.3,  164. ],
 [   3.4,  154. ],
 [   4.8,  144. ],
 [   5.9,  134. ],
 [   7.3,  123. ],
 [   9. ,  113. ],
 [  11.4,  103. ],
 [  14.4,   93. ],
 [  17.3,   82. ],
 [  19.8,   72. ],
 [  21.9,   62. ],
 [  23.1,   52. ],
 [  22.9,   41. ],
 [  21.5,   31. ],
 [  18.9,   20. ],
 [  15.9,   10. ],
 [  15. ,   -0. ],
 [ -15. ,    0. ],
 [ -14. ,   10. ],
 [ -13. ,   21. ],
 [  -9. ,   30. ],
 [  -7. ,   41. ],
 [  -7. ,   51. ],
 [  -8. ,   61. ],
 [ -11. ,   71. ],
 [ -13. ,   81. ],
 [ -17. ,   91. ],
 [ -19. ,  101. ],
 [ -21. ,  111. ],
 [ -23. ,  122. ],
 [ -24. ,  132. ],
 [ -25. ,  142. ],
 [ -28. ,  152. ],
 [ -36. ,  159. ],
 [ -44. ,  165. ],
 [ -52. ,  171. ],
 [ -61. ,  176. ],
 [ -70. ,  182. ],
 [ -78. ,  188. ],
 [ -86. ,  195. ],
 [ -93. ,  202. ],
 [-100. ,  210. ],
 [-108. ,  217. ],
 [-117. ,  222. ],
 [-127. ,  225. ],
 [-138. ,  226. ]])

points_2d = np.array([[ 30.3,   3. ],
 [ 29.3,  10. ],
 [ 25.1,  15. ],
 [ 19.8,  15. ],
 [ 15.7,  10. ],
 [ 14.7,   3. ],
 [-15. ,  -3. ],
 [-15. ,   2. ],
 [-15. ,   7. ],
 [-15. ,  13. ],
 [-13. ,  18. ],
 [-11. ,  22. ],
 [ -9. ,  27. ],
 [ -6. ,  31. ],
 [ -3. ,  35. ],
 [  1. ,  39. ],
 [  5. ,  42. ],
 [ 10. ,  45. ],
 [ 15. ,  46. ],
 [ 20. ,  47. ],
 [ 25. ,  47. ],
 [ 30. ,  46. ],
 [ 35. ,  45. ],
 [ 40. ,  42. ],
 [ 44. ,  39. ],
 [ 48. ,  35. ],
 [ 51. ,  31. ],
 [ 54. ,  27. ],
 [ 56. ,  22. ],
 [ 58. ,  18. ],
 [ 60. ,  13. ],
 [ 60. ,   7. ],
 [ 60. ,   2. ],
 [ 60. ,  -3. ]])

def setdiff2d_iter(arr1, arr2):
    delta = set(map(tuple, arr2))
    return np.fromiter((x for xs in arr1 if tuple(xs) not in delta for x in xs), dtype=arr1.dtype).reshape(-1, arr1.shape[-1])


i = 0.01

#shape with i as alpha
alpha_shape = alphashape.alphashape(points_2d, i)
fig, ax = plt.subplots()
ax.scatter(*zip(*points_2d))
ax.add_patch(PolygonPatch(alpha_shape, alpha=0.3))
plt.show()

a = np.array(alpha_shape.exterior.coords)
print(a)
print(len(list(alpha_shape.exterior.coords)))
print(len(points_2d)+1)
print(alpha_shape)

try:
    while len(list(alpha_shape.exterior.coords)) !=len(a)+1 :
        try:
            i += 0.01
            alpha_shape = alphashape.alphashape(points_2d, i)
            print(i)
            b = np.array(alpha_shape.exterior.coords)
        except:
            pass
except:
    pass

#convex(points_2d)
#print(points_2d)
#print(a)

c = setdiff2d_iter(points_2d,a)





fig, ax = plt.subplots()
ax.scatter(*zip(*points_2d))
ax.add_patch(PolygonPatch(alpha_shape, alpha=0.3))
plt.show()